做过im的应该都遇到过键盘输入和表情输入闪一下的问题，这里就讲一下解决这个方案，首先需要了解下android:windowSoftInputMode属性<br>
[http://blog.csdn.net/twoicewoo/article/details/7384398] (android:windowSoftInputMode属性详解)
activity主窗口与软键盘的交互模式，可以用来避免输入法面板遮挡问题，Android1.5后的一个新特性。
这个属性能影响两件事情：
【一】当有焦点产生时，软键盘是隐藏还是显示
【二】是否减少活动主窗口大小以便腾出空间放软键盘
它的设置必须是下面列表中的一个值，或一个”state…”值加一个”adjust…”值的组合。在任一组设置多个值——多个”state…”values，例如＆mdash有未定义的结果。各个值之间用|分开。例如:<activity android:windowSoftInputMode="stateVisible|adjustResize". . . >

在这设置的值(除"stateUnspecified"和"adjustUnspecified"以外)将覆盖在主题中设置的值


    各值的含义：
    【A】stateUnspecified：软键盘的状态并没有指定，系统将选择一个合适的状态或依赖于主题的设置
    【B】stateUnchanged：当这个activity出现时，软键盘将一直保持在上一个activity里的状态，无论是隐藏还是显示
    【C】stateHidden：用户选择activity时，软键盘总是被隐藏
    【D】stateAlwaysHidden：当该Activity主窗口获取焦点时，软键盘也总是被隐藏的
    【E】stateVisible：软键盘通常是可见的
    【F】stateAlwaysVisible：用户选择activity时，软键盘总是显示的状态
    【G】adjustUnspecified：默认设置，通常由系统自行决定是隐藏还是显示
    【H】adjustResize：该Activity总是调整屏幕的大小以便留出软键盘的空间
    【I】adjustPan：当前窗口的内容将自动移动以便当前焦点从不被键盘覆盖和用户能总是看到输入内容的部分

网上找到有2种方式方式比较不错 <br>
[http://www.dss886.com/2015/12/16/01/] (Android：实现类似QQ、微信的表情输入键盘)
## 界面跳动的原因

    但是运行起来会发现一个问题，点击按钮打开表情键盘时，输入框会上下跳动一下。分析一下原因，点击按钮后，先收起了软键盘，当前Activity的高度变高，输入框回到了界面底部；再打开表情键盘时，输入框又被顶上来，所有看起来点击按钮后输入框会上下跳动一下。无论是先隐藏软键盘还是先打开表情键盘都会有这个问题。

这种方法的原理是在弹起键盘和收起键盘时先固定布局，在收起和谈起之后再取消锁定，这里锁定的方法是代码设置weigh＝0，并且设置高度，取消锁定这里是直接设置weight＝1，还有一个细节是把表情布局高度设置为键盘的高度，这样切换的时候就不会跳动了，核心代码如下
##### 设置表情布局高度为键盘高度
```Java
    private int getSupportSoftInputHeight() {
        Rect r = new Rect();
        mActivity.getWindow().getDecorView().getWindowVisibleDisplayFrame(r);
        int screenHeight = mActivity.getWindow().getDecorView().getRootView().getHeight();
        int softInputHeight = screenHeight - r.bottom;
        if (Build.VERSION.SDK_INT >= 20) {
            // When SDK Level >= 20 (Android L), the softInputHeight will contain the height of softButtonsBar (if has)
            softInputHeight = softInputHeight - getSoftButtonsBarHeight();
        }
        if (softInputHeight < 0) {
            Log.w("EmotionInputDetector", "Warning: value of softInputHeight is below zero!");
        }
        if (softInputHeight > 0) {
            sp.edit().putInt(SHARE_PREFERENCE_TAG, softInputHeight).apply();
        }
        return softInputHeight;
    }
    
    private void showEmotionLayout() {
        int softInputHeight = getSupportSoftInputHeight();
        if (softInputHeight == 0) {
            softInputHeight = sp.getInt(SHARE_PREFERENCE_TAG, 400);
        }
        hideSoftInput();
        mEmotionLayout.getLayoutParams().height = softInputHeight;
        mEmotionLayout.setVisibility(View.VISIBLE);
    }
```
##### 锁定布局
```Java
    private void lockContentHeight() {
        LinearLayout.LayoutParams params = (LinearLayout.LayoutParams) mContentView.getLayoutParams();
        params.height = mContentView.getHeight();
        params.weight = 0.0F;
    }

```
##### 解锁键盘
```Java
    private void unlockContentHeightDelayed() {
        mEditText.postDelayed(new Runnable() {
            @Override
            public void run() {
                ((LinearLayout.LayoutParams) mContentView.getLayoutParams()).weight = 1.0F;
            }
        }, 200L);
    }
```
##### 聊天输入
```Java
    lockContentHeight();
    hideEmotionLayout(true);
    mEditText.postDelayed(
        new Runnable() {
            @Override
            public void run() {
        unlockContentHeightDelayed();
      }
    }, 200L);
```
##### 弹起表情
```Java
  if (isSoftInputShown()) {
      lockContentHeight();
      showEmotionLayout();
      unlockContentHeightDelayed();
  } else {
      showEmotionLayout();
  }
```
